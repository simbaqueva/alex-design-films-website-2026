<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Wompi Errors Fixed</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
        }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
            border: 1px solid #e9ecef;
        }

        .log {
            background: #000;
            color: #00ff00;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 11px;
            max-height: 300px;
            overflow-y: auto;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }

        button:hover {
            background: #0056b3;
        }
    </style>
</head>

<body>
    <h1>üîß Test Wompi Errors Fixed</h1>

    <div id="test-results">
        <div class="status info">üîÑ Inicializando prueba...</div>
    </div>

    <!-- Wompi Error Suppressor - DEBE cargarse PRIMERO -->
    <script src="./assets/js/wompi-error-suppressor.js"></script>

    <!-- Wompi Widget Script -->
    <script src="https://checkout.wompi.co/widget.js" async defer></script>

    <!-- Configuraci√≥n y M√≥dulos -->
    <script type="module">
        import { WOMPI_CONFIG } from './assets/js/config/wompi-config.js';
        import { initializeWompi } from './assets/js/modules/wompi-integration.js';

        // Funci√≥n para mostrar resultados
        function showStatus(message, type = 'info') {
            const results = document.getElementById('test-results');
            results.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Funci√≥n para mostrar logs
        function showLog(message) {
            const results = document.getElementById('test-results');
            const logDiv = document.createElement('div');
            logDiv.className = 'log';
            logDiv.textContent = message;
            results.appendChild(logDiv);
        }

        // Esperar a que todo cargue
        window.addEventListener('load', async () => {
            try {
                showStatus('üîç Verificando configuraci√≥n de Wompi...', 'info');

                // Verificar configuraci√≥n
                const configValid = WOMPI_CONFIG.validate();
                showStatus(configValid ? '‚úÖ Configuraci√≥n de Wompi v√°lida' : '‚ùå Configuraci√≥n de Wompi inv√°lida',
                    configValid ? 'success' : 'error');

                if (configValid) {
                    showStatus('üîÑ Inicializando Wompi...', 'info');

                    // Intentar inicializar Wompi
                    const wompiIntegration = initializeWompi(WOMPI_CONFIG.getWompiConfig());

                    if (wompiIntegration) {
                        showStatus('‚úÖ Wompi inicializado correctamente', 'success');

                        // Verificar que est√© disponible globalmente
                        if (window.wompiIntegration) {
                            showStatus('‚úÖ Wompi disponible globalmente', 'success');
                        } else {
                            showStatus('‚ùå Wompi no disponible globalmente', 'error');
                        }

                        // Verificar que el widget est√© cargado
                        if (window.WidgetCheckout && typeof window.WidgetCheckout === 'function') {
                            showStatus('‚úÖ WidgetCheckout disponible', 'success');
                        } else {
                            showStatus('‚ùå WidgetCheckout no disponible', 'error');
                        }

                        // Verificar que el error suppressor est√© activo
                        if (window.__wompiInitialized) {
                            showStatus('‚úÖ Error suppressor activo', 'success');
                        } else {
                            showStatus('‚ùå Error suppressor no activo', 'warning');
                        }

                    } else {
                        showStatus('‚ùå Error al inicializar Wompi', 'error');
                    }
                } else {
                    showStatus('‚ùå Saltando inicializaci√≥n de Wompi por configuraci√≥n inv√°lida', 'warning');
                }

                // Mostrar resumen
                const summary = document.createElement('div');
                summary.innerHTML = `
                    <h3>üìã Resumen de la prueba</h3>
                    <div class="status ${configValid ? 'success' : 'error'}">
                        Configuraci√≥n: ${configValid ? 'V√°lida' : 'Inv√°lida'}
                    </div>
                    <div class="status ${window.__wompiInitialized ? 'success' : 'error'}">
                        Error Suppressor: ${window.__wompiInitialized ? 'Activo' : 'Inactivo'}
                    </div>
                    <div class="status ${window.WidgetCheckout ? 'success' : 'error'}">
                        WidgetCheckout: ${window.WidgetCheckout ? 'Disponible' : 'No disponible'}
                    </div>
                    <div class="status ${window.wompiIntegration ? 'success' : 'error'}">
                        Integraci√≥n: ${window.wompiIntegration ? 'Exitosa' : 'Fallida'}
                    </div>
                `;
                document.getElementById('test-results').appendChild(summary);

            } catch (error) {
                showStatus(`‚ùå Error en la prueba: ${error.message}`, 'error');
                showLog(`Error detallado: ${error.stack}`, 'error');
            }
        });

        // Capturar errores de consola
        const originalError = console.error;
        console.error = function (...args) {
            showLog(`‚ùå CONSOLE ERROR: ${args.join(' ')}`);
            originalError.apply(console, args);
        };

        const originalWarn = console.warn;
        console.warn = function (...args) {
            showLog(`‚ö†Ô∏è CONSOLE WARNING: ${args.join(' ')}`);
            originalWarn.apply(console, args);
        };
    </script>
</body>

</html>